{"version":3,"sources":["database.js"],"names":[],"mappings":"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","file":"database.js","sourcesContent":["'use strict';\n\nclass Database {\n    static db = {};\n    static mongoDb = null;\n    static debug = false;\n\n    //option : {debug:如果为true,不会存储到mongodb}\n    constructor (_mongoDb) {\n\n        Database.mongoDb = _mongoDb;\n\n        Database.mongoDb.collection('DISH').find({}).toArray().then(r=>Database.db.DISH = r);\n        Database.mongoDb.collection('FOLLOW').find({}).toArray().then(r=>Database.db.FOLLOW = r);\n        Database.mongoDb.collection('GROUP').find({}).toArray().then(r=>Database.db.GROUP = r);\n        Database.mongoDb.collection('GROUP_DISHES').find({}).toArray().then(r=>Database.db.GROUP_DISHES = r);\n        Database.mongoDb.collection('GROUP_MEMBER').find({}).toArray().then(r=>Database.db.GROUP_MEMBER = r);\n        Database.mongoDb.collection('GROUP_ORDER').find({}).toArray().then(r=>Database.db.GROUP_ORDER = r);\n        Database.mongoDb.collection('MERCHANT').find({}).toArray().then(r=>Database.db.MERCHANT = r);\n        Database.mongoDb.collection('ORDER').find({}).toArray().then(r=>Database.db.ORDER = r);\n        Database.mongoDb.collection('USER').find({}).toArray().then(r=>Database.db.USER = r);\n    }\n\n    pushToDb(table, value) {\n\n        //jsonDb.push('/db/' + table + '[]', value);\n        console.log(Database.mongoDb);\n\n        !Database.debug && Database.mongoDb.collection(table).insertOne(value).then(r=> {\n            value._id = r.insertedId;\n            Database.db[table].push(value);\n        });\n    }\n\n    delFromJsonDb(table, condition) {\n        let index = Database.db[table].findIndex(condition);\n        Database.db[table].splice(index, 1);\n        !Database.debug && Database.mongoDb.collection(table).deleteOne({_id: Database.db[table]._id});\n\n        //jsonDb.delete(`/Database.db/${table}[${index}]`);\n    }\n\n    setValueToDb(table, condition, setKey, newValue) {\n        console.log(Database.db[table]);\n        let index = Database.db[table].findIndex(condition);\n        let oldObj = Database.db[table][index][setKey] = newValue;\n        let set = {};\n        set[setKey] = newValue;\n        !Database.debug && Database.mongoDb.collection(table).updateOne({_id: Database.db[index]._id}, {$set: set}).catch(e=>console.log(e));\n\n        //jsonDb.push('/db/' + table + `[${index}]`, oldObj);\n        //    db[table].push(value);\n    }\n\n\n    pushToDbPromise(table, value) {\n        return new Promise((resolve, reject)=> {\n            !Database.debug && Database.mongoDb.collection(table).insertOne(value).then(r=> {\n                value._id = r.insertedId;\n                Database.db[table].push(value);\n                resolve();\n            }).catch(e=>reject(e));\n        });\n\n    }\n\n    delFromJsonDbPromise(table, condition) {\n        return new Promise((resolve, reject)=> {\n\n            let index = Database.db[table].findIndex(condition);\n            Database.db[table].splice(index, 1);\n            !Database.debug && Database.mongoDb.collection(table).deleteOne({_id: Database.db[table]._id}).then(r=> {\n                resolve();\n            }).catch(e=>reject(e));\n\n        });\n    }\n\n    setValueToDbPromise(table, condition, setKey, newValue) {\n\n        return new Promise((resolve, reject)=> {\n\n            let index = Database.db[table].findIndex(condition);\n            let oldObj = Database.db[table][index][setKey] = newValue;\n            let set = {};\n            set[setKey] = newValue;\n            !Database.debug && Database.mongoDb.collection(table).updateOne({_id: Database.db[index]._id}, {$set: set}).catch(e=>console.log(e)).then(r=>{\n                resolve();\n            }).catch(e=>reject(e));\n        });\n    }\n\n    debug(isDebug){\n        debug = isDebug;\n     }\n\n\n}\n\nmodule.exports = Database;\n\n"],"sourceRoot":"/source/"}